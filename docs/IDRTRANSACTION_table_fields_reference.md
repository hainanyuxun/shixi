# IDRTRANSACTION表字段分析参考

## 表结构概述
IDRTRANSACTION表是InvestCloud的交易记录表，存储所有交易活动的详细信息。这是客户流失预测项目中的第三个核心数据表，提供客户交易行为的深度洞察。

## 关键字段分析

### 核心标识字段

#### ACCOUNTSHORTNAME (必填)
- **数据类型**: VARCHAR2(50 BYTE)
- **业务含义**: NB账户ID，必须唯一
- **关联关系**: 与beamaccount表的主键关联
- **流失预测价值**: ⭐⭐⭐⭐⭐ (关键关联字段)

#### FOREIGNACCOUNTINGKEY (必填)
- **数据类型**: VARCHAR2(100 BYTE) 
- **业务含义**: 日记账交易的唯一标识
- **流失预测价值**: ⭐⭐⭐ (交易唯一性追踪)

### 交易金额字段 (核心特征)

#### BOOKAMOUNT (必填)
- **数据类型**: NUMBER(20,5)
- **业务含义**: 账簿货币的总交易金额 (USD)
- **计算公式**: 本金金额 + 收入金额
- **流失预测价值**: ⭐⭐⭐⭐⭐ (交易规模核心指标)

#### LOCALAMOUNT (必填)
- **数据类型**: NUMBER(20,5)
- **业务含义**: 本地货币的净交易金额
- **流失预测价值**: ⭐⭐⭐⭐ (多币种交易分析)

#### BOOKNETCASH
- **数据类型**: NUMBER(20,5)
- **业务含义**: 基于生效日期的账簿净现金
- **流失预测价值**: ⭐⭐⭐⭐ (现金流分析)

### 交易行为字段

#### EVENTTYPE (必填)
- **数据类型**: VARCHAR2(40 BYTE)
- **业务含义**: 交易类型代码 (如PSDR-购买证券借方)
- **流失预测价值**: ⭐⭐⭐⭐⭐ (交易模式分析)

#### QUANTITY (必填)
- **数据类型**: NUMBER(20,5)
- **业务含义**: 受影响的证券数量
- **流失预测价值**: ⭐⭐⭐⭐ (交易规模)

#### BOOKPRICE (必填)
- **数据类型**: NUMBER(20,5)
- **业务含义**: 账簿价格
- **流失预测价值**: ⭐⭐⭐ (价格敏感性)

### 时间相关字段

#### EVENTDATE (必填)
- **数据类型**: DATE
- **业务含义**: 事件生效日期
- **流失预测价值**: ⭐⭐⭐⭐⭐ (时间序列分析核心)

#### TRADEDATE (必填)
- **数据类型**: DATE
- **业务含义**: 交易日期
- **流失预测价值**: ⭐⭐⭐⭐⭐ (交易频率分析)

#### ACTUALSETTLEMENTDATE
- **数据类型**: DATE
- **业务含义**: 实际结算日期
- **流失预测价值**: ⭐⭐⭐ (结算风险分析)

### 损益字段

#### BOOKTOTALGAIN
- **数据类型**: NUMBER(20,5)
- **业务含义**: 账簿货币的总已实现收益 (>= 0)
- **流失预测价值**: ⭐⭐⭐⭐⭐ (投资表现核心指标)

#### BOOKTOTALLOSS
- **数据类型**: NUMBER(20,5)
- **业务含义**: 账簿货币的总已实现损失 (< 0)
- **流失预测价值**: ⭐⭐⭐⭐⭐ (损失承受能力)

#### BOOKREALIZEDGL
- **数据类型**: NUMBER(20,5)
- **业务含义**: 账簿已实现损益
- **流失预测价值**: ⭐⭐⭐⭐⭐ (投资表现)

#### BOOKLONGTERMGL & BOOKSHORTTERMGL
- **数据类型**: NUMBER(20,5)
- **业务含义**: 长期/短期资本损益
- **流失预测价值**: ⭐⭐⭐⭐ (投资策略分析)

### 证券信息字段

#### ENTERPRISESYMBOL (必填)
- **数据类型**: VARCHAR2(100 BYTE)
- **业务含义**: NB证券ID，100%唯一标识符
- **流失预测价值**: ⭐⭐⭐ (资产多样性分析)

#### SECURITYDESCRIPTION (必填)
- **数据类型**: VARCHAR2(255 BYTE)
- **业务含义**: 证券完整描述
- **流失预测价值**: ⭐⭐ (资产类别分析)

#### ASSETCLASSLEVEL1 (必填)
- **数据类型**: VARCHAR2(50 BYTE)
- **业务含义**: 主要资产类别 (股票、固定收益、另类投资、现金等)
- **流失预测价值**: ⭐⭐⭐⭐ (资产配置分析)

#### ASSETCLASSLEVEL2 & ASSETCLASSLEVEL3
- **数据类型**: VARCHAR2(50 BYTE)
- **业务含义**: 二级和三级资产分类
- **流失预测价值**: ⭐⭐⭐ (细分资产偏好)

### 费用和佣金字段

#### BOOKBROKERCOMMISSION
- **数据类型**: NUMBER(20,5)
- **业务含义**: 经纪人佣金
- **流失预测价值**: ⭐⭐⭐ (成本敏感性)

#### BOOKSECFEE
- **数据类型**: NUMBER(20,5)
- **业务含义**: SEC费用
- **流失预测价值**: ⭐⭐ (交易成本)

### 策略和管理字段

#### MANAGERNAME
- **数据类型**: VARCHAR2(100 BYTE)
- **业务含义**: 投资组合经理姓名或代码
- **流失预测价值**: ⭐⭐⭐ (服务关系)

#### STRATEGYCODE & STRATEGYNAME
- **数据类型**: VARCHAR2(40/100 BYTE)
- **业务含义**: 交易策略代码和名称
- **流失预测价值**: ⭐⭐⭐ (投资偏好)

## 流失预测特征工程建议

### 1. 交易活跃度特征 (一级重要)
```sql
-- 基于EVENTDATE和TRADEDATE的时间序列特征
- 最后交易距今天数
- 30/60/90天交易频率
- 交易频率变化趋势
- 交易金额波动性
```

### 2. 财务表现特征 (一级重要)
```sql
-- 基于BOOKTOTALGAIN/LOSS的投资表现
- 总收益率
- 收益损失比率
- 长期vs短期投资偏好
- 风险调整收益
```

### 3. 交易行为模式 (一级重要)
```sql
-- 基于EVENTTYPE和QUANTITY的行为分析
- 买入vs卖出比例
- 平均交易规模
- 交易类型多样性
- 集中度指标
```

### 4. 资产配置特征 (二级重要)
```sql
-- 基于ASSETCLASS字段的配置分析
- 资产类别多样性
- 股债比例
- 另类投资占比
- 配置变化趋势
```

### 5. 成本敏感性特征 (二级重要)
```sql
-- 基于佣金和费用字段
- 交易成本比率
- 费用敏感性
- 成本优化行为
```

## 数据质量考量

### 缺失值处理
- **BOOKTOTALGAIN/LOSS**: 可能存在NULL值，需要区分0和NULL
- **时间字段**: 确保EVENTDATE和TRADEDATE的完整性
- **价格字段**: 检查异常价格数据

### 异常值检测
- **BOOKAMOUNT**: 识别异常大额交易
- **QUANTITY**: 检测批量交易
- **价格波动**: 识别市场异常日期

### 业务逻辑验证
- 买入交易：BOOKAMOUNT为负值（现金流出）
- 卖出交易：BOOKAMOUNT为正值（现金流入）
- 损益一致性：总损益 = 总收益 + 总损失

## 与其他表的关联

### 与beamaccount表
```sql
JOIN beamaccount b ON i.ACCOUNTSHORTNAME = b.ACCOUNTSHORTNAME
```

### 与PROFITANDLOSSLITE表
```sql
-- 通过账户名称和日期关联，进行资产价值vs交易活动分析
JOIN PROFITANDLOSSLITE p ON i.ACCOUNTSHORTNAME = p.ACCOUNTSHORTNAME 
    AND i.EVENTDATE = p.BE_ASOF
```

## 建议提取的核心特征
1. **交易频率衰退**: 近30天vs前30天交易次数比较
2. **资金流出倾向**: 净卖出金额占总资产比例
3. **投资表现恶化**: 连续亏损期间长度
4. **交易规模下降**: 平均交易金额的下降趋势
5. **资产集中度上升**: 向单一资产类别的集中程度

这些特征将为客户流失预测模型提供强有力的预测信号。 